# Auto-generated from expert.yaml by tools/generate-hybrid-codex.mjs
# Do not edit manually. Edit the source piece and re-run the generator.

name: expert-hybrid-codex
description: Architecture, Frontend, Security, QA Expert Review
max_iterations: 30
knowledge:
  frontend: ../knowledge/frontend.md
  backend: ../knowledge/backend.md
  security: ../knowledge/security.md
  architecture: ../knowledge/architecture.md
personas:
  planner: ../personas/planner.md
  coder: ../personas/coder.md
  ai-antipattern-reviewer: ../personas/ai-antipattern-reviewer.md
  architecture-reviewer: ../personas/architecture-reviewer.md
  frontend-reviewer: ../personas/frontend-reviewer.md
  security-reviewer: ../personas/security-reviewer.md
  qa-reviewer: ../personas/qa-reviewer.md
  expert-supervisor: ../personas/expert-supervisor.md
instructions:
  plan: ../instructions/plan.md
  implement: ../instructions/implement.md
  ai-review: ../instructions/ai-review.md
  ai-fix: ../instructions/ai-fix.md
  arbitrate: ../instructions/arbitrate.md
  review-arch: ../instructions/review-arch.md
  review-frontend: ../instructions/review-frontend.md
  review-security: ../instructions/review-security.md
  review-qa: ../instructions/review-qa.md
  fix: ../instructions/fix.md
  supervise: ../instructions/supervise.md
  fix-supervisor: ../instructions/fix-supervisor.md
initial_movement: plan
movements:
  - name: plan
    edit: false
    persona: planner
    report:
      name: 00-plan.md
      format: plan
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Bash
      - WebSearch
      - WebFetch
    instruction: plan
    rules:
      - condition: Task analysis and planning is complete
        next: implement
      - condition: Requirements are unclear and planning cannot proceed
        next: ABORT
  - name: implement
    edit: true
    persona: coder
    provider: codex
    policy:
      - coding
      - testing
    session: refresh
    knowledge:
      - frontend
      - backend
      - security
      - architecture
    report:
      - Scope: 01-coder-scope.md
      - Decisions: 02-coder-decisions.md
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Edit
      - Write
      - Bash
      - WebSearch
      - WebFetch
    instruction: implement
    rules:
      - condition: Implementation is complete
        next: ai_review
      - condition: No implementation (report only)
        next: ai_review
      - condition: Cannot proceed with implementation
        next: ai_review
      - condition: User input required
        next: implement
        requires_user_input: true
        interactive_only: true
  - name: ai_review
    edit: false
    persona: ai-antipattern-reviewer
    policy:
      - review
      - ai-antipattern
    report:
      name: 03-ai-review.md
      format: ai-review
    allowed_tools:
      - Read
      - Glob
      - Grep
      - WebSearch
      - WebFetch
    instruction: ai-review
    rules:
      - condition: No AI-specific issues found
        next: reviewers
      - condition: AI-specific issues detected
        next: ai_fix
  - name: ai_fix
    edit: true
    persona: coder
    provider: codex
    policy:
      - coding
      - testing
    session: refresh
    knowledge:
      - frontend
      - backend
      - security
      - architecture
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Edit
      - Write
      - Bash
      - WebSearch
      - WebFetch
    instruction: ai-fix
    rules:
      - condition: AI Reviewer's issues have been fixed
        next: ai_review
      - condition: No fix needed (verified target files/spec)
        next: ai_no_fix
      - condition: Unable to proceed with fixes
        next: ai_no_fix
  - name: ai_no_fix
    edit: false
    persona: architecture-reviewer
    policy: review
    allowed_tools:
      - Read
      - Glob
      - Grep
    rules:
      - condition: ai_review's findings are valid (fix required)
        next: ai_fix
      - condition: ai_fix's judgment is valid (no fix needed)
        next: reviewers
    instruction: arbitrate
  - name: reviewers
    parallel:
      - name: arch-review
        edit: false
        persona: architecture-reviewer
        policy: review
        knowledge:
          - architecture
          - backend
        report:
          name: 04-architect-review.md
          format: architecture-review
        allowed_tools:
          - Read
          - Glob
          - Grep
          - WebSearch
          - WebFetch
        rules:
          - condition: approved
          - condition: needs_fix
        instruction: review-arch
      - name: frontend-review
        edit: false
        persona: frontend-reviewer
        policy: review
        knowledge: frontend
        report:
          name: 05-frontend-review.md
          format: frontend-review
        allowed_tools:
          - Read
          - Glob
          - Grep
          - WebSearch
          - WebFetch
        rules:
          - condition: approved
          - condition: needs_fix
        instruction: review-frontend
      - name: security-review
        edit: false
        persona: security-reviewer
        policy: review
        knowledge: security
        report:
          name: 06-security-review.md
          format: security-review
        allowed_tools:
          - Read
          - Glob
          - Grep
          - WebSearch
          - WebFetch
        rules:
          - condition: approved
          - condition: needs_fix
        instruction: review-security
      - name: qa-review
        edit: false
        persona: qa-reviewer
        policy:
          - review
          - qa
        report:
          name: 07-qa-review.md
          format: qa-review
        allowed_tools:
          - Read
          - Glob
          - Grep
          - WebSearch
          - WebFetch
        rules:
          - condition: approved
          - condition: needs_fix
        instruction: review-qa
    rules:
      - condition: all("approved")
        next: supervise
      - condition: any("needs_fix")
        next: fix
  - name: fix
    edit: true
    persona: coder
    provider: codex
    policy:
      - coding
      - testing
    knowledge:
      - frontend
      - backend
      - security
      - architecture
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Edit
      - Write
      - Bash
      - WebSearch
      - WebFetch
    permission_mode: edit
    rules:
      - condition: Fix complete
        next: reviewers
      - condition: Cannot proceed, insufficient info
        next: plan
    instruction: fix
  - name: supervise
    edit: false
    persona: expert-supervisor
    policy: review
    report:
      - Validation: 08-supervisor-validation.md
      - Summary: summary.md
    allowed_tools:
      - Read
      - Glob
      - Grep
      - WebSearch
      - WebFetch
    instruction: supervise
    rules:
      - condition: All validations pass and ready to merge
        next: COMPLETE
      - condition: Issues detected during final review
        next: fix_supervisor
  - name: fix_supervisor
    edit: true
    persona: coder
    provider: codex
    policy:
      - coding
      - testing
    knowledge:
      - frontend
      - backend
      - security
      - architecture
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Edit
      - Write
      - Bash
      - WebSearch
      - WebFetch
    instruction: fix-supervisor
    rules:
      - condition: Supervisor's issues have been fixed
        next: supervise
      - condition: Unable to proceed with fixes
        next: plan
policies:
  coding: ../policies/coding.md
  review: ../policies/review.md
  testing: ../policies/testing.md
  ai-antipattern: ../policies/ai-antipattern.md
  qa: ../policies/qa.md
output_contracts:
  plan: ../output-contracts/plan.md
  ai-review: ../output-contracts/ai-review.md
  architecture-review: ../output-contracts/architecture-review.md
  frontend-review: ../output-contracts/frontend-review.md
  security-review: ../output-contracts/security-review.md
  qa-review: ../output-contracts/qa-review.md
  validation: ../output-contracts/validation.md
  summary: ../output-contracts/summary.md
