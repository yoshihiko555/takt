# Auto-generated from review-fix-minimal.yaml by tools/generate-hybrid-codex.mjs
# Do not edit manually. Edit the source piece and re-run the generator.

name: review-fix-minimal-hybrid-codex
description: Review and fix piece for existing code (starts with review, no implementation)
max_iterations: 20
personas:
  coder: ../personas/coder.md
  ai-antipattern-reviewer: ../personas/ai-antipattern-reviewer.md
  supervisor: ../personas/supervisor.md
instructions:
  implement: ../instructions/implement.md
  review-ai: ../instructions/review-ai.md
  ai-fix: ../instructions/ai-fix.md
  supervise: ../instructions/supervise.md
  fix-supervisor: ../instructions/fix-supervisor.md
initial_movement: reviewers
movements:
  - name: implement
    edit: true
    persona: coder
    provider: codex
    policy:
      - coding
      - testing
    report:
      - Scope: 01-coder-scope.md
      - Decisions: 02-coder-decisions.md
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Edit
      - Write
      - Bash
      - WebSearch
      - WebFetch
    permission_mode: edit
    instruction: implement
    rules:
      - condition: Implementation complete
        next: reviewers
      - condition: Cannot proceed, insufficient info
        next: ABORT
      - condition: User input required because there are items to confirm with the user
        next: implement
        requires_user_input: true
        interactive_only: true
  - name: reviewers
    parallel:
      - name: ai_review
        edit: false
        persona: ai-antipattern-reviewer
        policy:
          - review
          - ai-antipattern
        report:
          name: 03-ai-review.md
          format: ai-review
        allowed_tools:
          - Read
          - Glob
          - Grep
          - WebSearch
          - WebFetch
        instruction: review-ai
        rules:
          - condition: No AI-specific issues
          - condition: AI-specific issues found
      - name: supervise
        edit: false
        persona: supervisor
        policy: review
        report:
          - Validation: 05-supervisor-validation.md
          - Summary: summary.md
        allowed_tools:
          - Read
          - Glob
          - Grep
          - Bash
          - WebSearch
          - WebFetch
        instruction: supervise
        rules:
          - condition: All checks passed
          - condition: Requirements unmet, tests failing
    rules:
      - condition: all("No AI-specific issues", "All checks passed")
        next: COMPLETE
      - condition: all("AI-specific issues found", "Requirements unmet, tests failing")
        next: fix_both
      - condition: any("AI-specific issues found")
        next: ai_fix
      - condition: any("Requirements unmet, tests failing")
        next: supervise_fix
  - name: fix_both
    parallel:
      - name: ai_fix_parallel
        edit: true
        persona: coder
        provider: codex
        policy:
          - coding
          - testing
        allowed_tools:
          - Read
          - Glob
          - Grep
          - Edit
          - Bash
          - WebSearch
          - WebFetch
        permission_mode: edit
        rules:
          - condition: AI Reviewer's issues fixed
          - condition: No fix needed (verified target files/spec)
          - condition: Cannot proceed, insufficient info
        instruction: ai-fix
      - name: supervise_fix_parallel
        edit: true
        persona: coder
        provider: codex
        policy:
          - coding
          - testing
        allowed_tools:
          - Read
          - Glob
          - Grep
          - Edit
          - Bash
          - WebSearch
          - WebFetch
        permission_mode: edit
        rules:
          - condition: Supervisor's issues fixed
          - condition: Cannot proceed, insufficient info
        instruction: fix-supervisor
    rules:
      - condition: all("AI Reviewer's issues fixed", "Supervisor's issues fixed")
        next: reviewers
      - condition: any("No fix needed (verified target files/spec)", "Cannot proceed, insufficient info")
        next: implement
  - name: ai_fix
    edit: true
    persona: coder
    provider: codex
    policy:
      - coding
      - testing
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Edit
      - Write
      - Bash
      - WebSearch
      - WebFetch
    permission_mode: edit
    rules:
      - condition: AI Reviewer's issues fixed
        next: reviewers
      - condition: No fix needed (verified target files/spec)
        next: implement
      - condition: Cannot proceed, insufficient info
        next: implement
    instruction: ai-fix
  - name: supervise_fix
    edit: true
    persona: coder
    provider: codex
    policy:
      - coding
      - testing
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Edit
      - Write
      - Bash
      - WebSearch
      - WebFetch
    permission_mode: edit
    rules:
      - condition: Supervisor's issues fixed
        next: reviewers
      - condition: Cannot proceed, insufficient info
        next: implement
    instruction: fix-supervisor
policies:
  coding: ../policies/coding.md
  review: ../policies/review.md
  testing: ../policies/testing.md
  ai-antipattern: ../policies/ai-antipattern.md
output_contracts:
  ai-review: ../output-contracts/ai-review.md
